<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Star Upgrader</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffaa00; --blue: #00f2ff; --bg: #0f111a; --card: #161b22; }
        body { background: var(--bg); color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .balance-box { background: var(--card); padding: 15px; border-radius: 15px; border: 2px solid var(--gold); width: 100%; text-align: center; font-size: 1.4rem; font-weight: bold; color: var(--gold); margin-bottom: 20px; box-sizing: border-box; }
        .mode-switch { display: flex; background: #000; border-radius: 25px; padding: 5px; border: 2px solid var(--blue); margin-bottom: 25px; }
        .mode-btn { padding: 10px 25px; border-radius: 20px; border: none; color: white; background: transparent; cursor: pointer; font-weight: bold; }
        .mode-btn.active { background: var(--blue); color: black; }
        .wheel-container { position: relative; width: 260px; height: 260px; margin-bottom: 30px; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid #222; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); transform: rotate(0deg); }
        .pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid var(--gold); z-index: 10; }
        .controls { width: 100%; background: var(--card); padding: 20px; border-radius: 25px; box-sizing: border-box; }
        input { width: 100%; background: #000; border: 1px solid var(--blue); color: white; padding: 12px; border-radius: 10px; text-align: center; margin-bottom: 10px; outline: none; }
        .m-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .m-btn { background: #1a1f29; border: 1px solid #444; color: white; padding: 10px 0; border-radius: 8px; font-size: 0.8rem; }
        .m-btn.active { border-color: var(--gold); color: var(--gold); }
        .btn-main { width: 100%; background: var(--gold); color: black; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .btn-sub { width: 100%; background: transparent; border: 1px solid var(--blue); color: var(--blue); padding: 10px; border-radius: 12px; cursor: pointer; margin-bottom: 5px; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div class="balance-box">üí∞ <span id="bal">1000.00</span> ‚≠êÔ∏è</div>

<div class="mode-switch">
    <button id="bD" class="mode-btn active" onclick="setM('demo')">DEMO</button>
    <button id="bR" class="mode-btn" onclick="setM('real')">REAL</button>
</div>

<div class="wheel-container">
    <div class="pointer"></div>
    <canvas id="wheel" width="300" height="300"></canvas>
</div>

<div class="controls">
    <input type="number" id="bet" value="20">
    <div class="m-grid">
        <button class="m-btn active" onclick="setMult(2, 50, this)">x2.0</button>
        <button class="m-btn" onclick="setMult(5, 20, this)">x5.0</button>
        <button class="m-btn" onclick="setMult(10, 10, this)">x10.0</button>
        <button class="m-btn" onclick="setMult(50, 2, this)">x50.0</button>
    </div>
    <button class="btn-main" onclick="spin()">–ê–ü–ì–†–ï–ô–î</button>
    <button class="btn-sub" onclick="showM('dep')">–ü–û–ü–û–õ–ù–ò–¢–¨</button>
    <button class="btn-sub" onclick="showM('out')">–í–´–í–û–î</button>
</div>

<div id="modal">
    <div style="background:#161b22; padding:20px; border-radius:15px; width:80%; text-align:center; border:1px solid var(--blue);">
        <h3 id="mTitle">–°–£–ú–ú–ê</h3>
        <input type="number" id="mAmt" value="100">
        <input type="text" id="mWallet" placeholder="ID / –ö–æ—à–µ–ª–µ–∫" style="display:none">
        <button class="btn-main" onclick="sendToBot()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
        <button class="btn-sub" onclick="closeM()">–û–¢–ú–ï–ù–ê</button>
    </div>
</div>

<script>
    let tg = window.Telegram.WebApp; tg.expand();
    let mode = 'demo', demoBal = 1000, currentMult = 2, greenSize = 50, spinning = false, rot = 0, act = '';

    function setM(m) { mode = m; document.getElementById('bD').className = m=='demo'?'mode-btn active':'mode-btn'; document.getElementById('bR').className = m=='real'?'mode-btn active':'mode-btn'; update(); }
    function setMult(v, s, b) { currentMult = v; greenSize = s; document.querySelectorAll('.m-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); draw(); }
    
    function draw() {
        const ctx = document.getElementById('wheel').getContext('2d');
        ctx.clearRect(0,0,300,300);
        let gRad = (greenSize/100)*Math.PI*2;
        ctx.beginPath(); ctx.moveTo(150,150); ctx.arc(150,150,140,-Math.PI/2, -Math.PI/2 + gRad); ctx.fillStyle = "#00ff88"; ctx.fill();
        ctx.beginPath(); ctx.moveTo(150,150); ctx.arc(150,150,140,-Math.PI/2 + gRad, -Math.PI/2 + Math.PI*2); ctx.fillStyle = "#ff3333"; ctx.fill();
    }

    function update() { document.getElementById('bal').innerText = mode=='demo'?demoBal.toFixed(2):'0.00 REAL'; }

    function spin() {
        if(spinning) return;
        let b = parseFloat(document.getElementById('bet').value);
        if(b < 20) return alert("–ú–∏–Ω–∏–º—É–º 20‚≠êÔ∏è");
        if(mode == 'demo') {
            if(demoBal < b) return alert("–ù–µ—Ç –∑–≤–µ–∑–¥");
            spinning = true; demoBal -= b; update();
            let win = Math.random() < 0.3; // 30% —à–∞–Ω—Å
            let target = win ? 0 : 180; // 0 - —Ü–µ–Ω—Ç—Ä –∑–µ–ª–µ–Ω–æ–≥–æ, 180 - —Ü–µ–Ω—Ç—Ä –∫—Ä–∞—Å–Ω–æ–≥–æ
            rot += (360*5) + (360 - (rot%360)) - target;
            document.getElementById('wheel').style.transform = `rotate(${rot}deg)`;
            setTimeout(() => {
                if(win) { demoBal += b * currentMult; alert("–í–´–ò–ì–†–´–®! üéâ"); } else { alert("–ü–†–û–ò–ì–†–´–® ‚ùå"); }
                spinning = false; update();
            }, 4000);
        } else {
            tg.sendData(JSON.stringify({action:"spin_real", bet:b}));
            tg.close();
        }
    }

    function showM(t) { act = t; document.getElementById('modal').style.display='flex'; document.getElementById('mTitle').innerText = t=='dep'?'–ü–û–ü–û–õ–ù–ï–ù–ò–ï':'–í–´–í–û–î'; document.getElementById('mWallet').style.display = t=='dep'?'none':'block'; }
    function closeM() { document.getElementById('modal').style.display='none'; }
    function sendToBot() {
        let val = document.getElementById('mAmt').value;
        let wal = document.getElementById('mWallet').value;
        tg.sendData(JSON.stringify({action: act, amount: val, wallet: wal}));
        tg.close();
    }
    draw();
</script>
</body>
</html>
