<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Star Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0f111a; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .bal-box { background: #161b22; padding: 15px; border-radius: 15px; border: 2px solid #ffaa00; width: 100%; text-align: center; color: #ffaa00; font-weight: bold; margin-bottom: 20px; }
        .mode-sw { display: flex; background: #000; border-radius: 20px; padding: 5px; margin-bottom: 20px; }
        .m-btn { padding: 10px 20px; border: none; background: none; color: white; cursor: pointer; font-weight: bold; }
        .m-btn.active { background: #00f2ff; color: black; border-radius: 15px; }
        .wheel-box { position: relative; width: 250px; height: 250px; margin-bottom: 20px; }
        .wheel-bg { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#ff3333 0deg 120deg, #00ff88 120deg 240deg, #ff3333 240deg 360deg); border: 4px solid #222; }
        #needle { position: absolute; width: 4px; height: 100px; background: #fff; top: 50%; left: 50%; transform-origin: 50% 0%; transition: 4s cubic-bezier(0.1, 0, 0.1, 1); transform: translate(-50%, 0) rotate(0deg); }
        .btn-go { width: 100%; background: #ffaa00; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-alt { width: 48%; background: none; border: 1px solid #00f2ff; color: #00f2ff; padding: 10px; border-radius: 10px; margin-top: 10px; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
    </style>
</head>
<body>
    <div class="bal-box">üí∞ <span id="balDisplay">0.00</span> ‚≠êÔ∏è</div>
    <div class="mode-sw">
        <button id="bD" class="m-btn active" onclick="setMode('demo')">DEMO</button>
        <button id="bR" class="m-btn" onclick="setMode('real')">REAL</button>
    </div>
    <div class="wheel-box">
        <div class="wheel-bg"></div>
        <div id="needle"></div>
    </div>
    <input type="number" id="bet" value="20" style="width:100%; padding:10px; margin-bottom:10px; background:#000; color:white; border:1px solid #333; text-align:center;">
    <button class="btn-go" onclick="play()">–ê–ü–ì–†–ï–ô–î</button>
    <div style="width:100%; display:flex; justify-content:space-between;">
        <button class="btn-alt" onclick="openM('dep')">–î–ï–ü</button>
        <button class="btn-alt" onclick="openM('out')">–í–´–í–û–î</button>
    </div>

    <div id="modal">
        <div style="background:#161b22; padding:20px; border-radius:15px; width:80%; text-align:center;">
            <h3 id="mT">–î–ï–ô–°–¢–í–ò–ï</h3>
            <input type="number" id="mA" value="100" style="width:90%; padding:10px; margin-bottom:10px;">
            <input type="text" id="mW" placeholder="–ö–æ—à–µ–ª–µ–∫" style="width:90%; padding:10px; display:none; margin-bottom:10px;">
            <button class="btn-go" onclick="confirm()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            <button class="btn-alt" style="width:100%" onclick="document.getElementById('modal').style.display='none'">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

<script>
    let tg = window.Telegram.WebApp; tg.expand();
    const urlParams = new URLSearchParams(window.location.search);
    let realBal = parseFloat(urlParams.get('bal')) || 0;
    let mode = 'demo', demoBal = 1000, spinning = false, rot = 0, currentAct = '';

    function update() { document.getElementById('balDisplay').innerText = (mode=='demo' ? demoBal : realBal).toFixed(2); }
    function setMode(m) { mode = m; document.getElementById('bD').className = m=='demo'?'m-btn active':'m-btn'; document.getElementById('bR').className = m=='real'?'m-btn active':'m-btn'; update(); }
    
    function play() {
        if(spinning) return;
        let b = parseFloat(document.getElementById('bet').value);
        if((mode=='demo' && demoBal < b) || (mode=='real' && realBal < b)) return alert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!");
        
        spinning = true;
        if(mode=='demo') demoBal -= b; else realBal -= b;
        update();

        let win = Math.random() < 0.4;
        let target = win ? (180 + (Math.random()*40-20)) : (0 + (Math.random()*40-20));
        rot += (360 * 5) + (target - (rot % 360));
        document.getElementById('needle').style.transform = `translate(-50%, 0) rotate(${rot}deg)`;

        setTimeout(() => {
            if(win) { if(mode=='demo') demoBal += b*2; else realBal += b*2; alert("üéÅ –í–´–ò–ì–†–´–®!"); }
            else alert("‚ùå –ü–†–û–ò–ì–†–´–®!");
            spinning = false; update();
        }, 4100);
    }

    function openM(t) { currentAct = t; document.getElementById('modal').style.display='flex'; document.getElementById('mT').innerText = t=='dep'?'–î–ï–ü':'–í–´–í–û–î'; document.getElementById('mW').style.display = t=='dep'?'none':'block'; }
    function confirm() {
        tg.sendData(JSON.stringify({action: currentAct, amount: document.getElementById('mA').value, wallet: document.getElementById('mW').value}));
        tg.close();
    }
    update();
</script>
</body>
</html>
