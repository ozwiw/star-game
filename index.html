<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Star Upgrader</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffaa00; --blue: #00f2ff; --bg: #0f111a; --card: #161b22; }
        body { background: var(--bg); color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; overflow: hidden; }
        .balance-box { background: var(--card); padding: 15px; border-radius: 15px; border: 2px solid var(--gold); width: 100%; text-align: center; font-size: 1.4rem; font-weight: bold; color: var(--gold); margin-bottom: 20px; box-sizing: border-box; }
        .mode-switch { display: flex; background: #000; border-radius: 25px; padding: 5px; border: 2px solid var(--blue); margin-bottom: 25px; }
        .mode-btn { padding: 8px 20px; border-radius: 20px; border: none; color: white; background: transparent; cursor: pointer; font-weight: bold; }
        .mode-btn.active { background: var(--blue); color: black; }
        .wheel-outer { position: relative; width: 260px; height: 260px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; }
        .static-wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid #222; background: conic-gradient(#ff3333 0deg 120deg, #00ff88 120deg 240deg, #ff3333 240deg 360deg); }
        #needle { position: absolute; width: 6px; height: 110px; background: #fff; top: 50%; left: 50%; transform-origin: 50% 0%; border-radius: 3px; z-index: 10; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); transform: translate(-50%, 0) rotate(0deg); }
        #needle::after { content: ''; position: absolute; bottom: -15px; left: -7px; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid #fff; }
        .controls { width: 100%; background: var(--card); padding: 20px; border-radius: 25px; box-sizing: border-box; }
        input { width: 100%; background: #000; border: 1px solid var(--blue); color: white; padding: 12px; border-radius: 10px; text-align: center; margin-bottom: 10px; outline: none; }
        .btn-main { width: 100%; background: var(--gold); color: black; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .btn-sub { width: 48%; background: transparent; border: 1px solid var(--blue); color: var(--blue); padding: 10px; border-radius: 12px; cursor: pointer; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div class="balance-box">üí∞ <span id="bal">1000.00</span> ‚≠êÔ∏è</div>
    <div class="mode-switch">
        <button id="bD" class="mode-btn active" onclick="setM('demo')">DEMO</button>
        <button id="bR" class="mode-btn" onclick="setM('real')">REAL</button>
    </div>
    <div class="wheel-outer">
        <div class="static-wheel"></div>
        <div id="needle"></div>
    </div>
    <div class="controls">
        <input type="number" id="bet" value="20">
        <button class="btn-main" onclick="spin()">–£–õ–£–ß–®–ò–¢–¨</button>
        <div style="display: flex; justify-content: space-between;">
            <button class="btn-sub" onclick="showM('dep')">–î–ï–ü</button>
            <button class="btn-sub" onclick="showM('out')">–í–´–í–û–î</button>
        </div>
    </div>
    <div id="modal">
        <div style="background:#161b22; padding:20px; border-radius:15px; width:80%; text-align:center; border:1px solid var(--blue);">
            <h3 id="mT">–î–ï–ô–°–¢–í–ò–ï</h3>
            <input type="number" id="mA" value="100">
            <div id="wB" style="display:none; margin-top:10px;"><input type="text" id="mW" placeholder="ID / –ö–æ—à–µ–ª–µ–∫"></div>
            <button class="btn-main" onclick="send()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            <button class="btn-sub" style="width:100%;" onclick="closeM()">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

<script>
    let tg = window.Telegram.WebApp; tg.expand();
    const urlParams = new URLSearchParams(window.location.search);
    let realBal = parseFloat(urlParams.get('bal')) || 0;
    let mode = 'demo', demoBal = 1000, spinning = false, curRot = 0, act = '';

    function update() { document.getElementById('bal').innerText = (mode == 'demo' ? demoBal : realBal).toFixed(2); }
    function setM(m) { 
        if(spinning) return; mode = m; 
        document.getElementById('bD').className = m=='demo'?'mode-btn active':'mode-btn';
        document.getElementById('bR').className = m=='real'?'mode-btn active':'mode-btn';
        update(); 
    }
    function spin() {
        if(spinning) return;
        let b = parseFloat(document.getElementById('bet').value);
        if((mode=='demo' && demoBal < b) || (mode=='real' && realBal < b)) return alert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!");
        spinning = true;
        if(mode=='demo') demoBal -= b; else realBal -= b;
        update();
        let win = Math.random() < 0.3;
        let target = win ? (180 + (Math.random()*40-20)) : (0 + (Math.random()*40-20));
        curRot += (360 * 5) + (target - (curRot % 360));
        document.getElementById('needle').style.transform = `translate(-50%, 0) rotate(${curRot}deg)`;
        setTimeout(() => {
            if(win) { if(mode=='demo') demoBal += b*2; else realBal += b*2; alert("üéÅ –í–´–ò–ì–†–´–®!"); }
            else { alert("‚ùå –ü–†–û–ò–ì–†–´–®!"); }
            spinning = false; update();
        }, 4100);
    }
    function showM(t) { act = t; document.getElementById('modal').style.display='flex'; document.getElementById('wB').style.display = t=='dep'?'none':'block'; }
    function closeM() { document.getElementById('modal').style.display='none'; }
    function send() {
        tg.sendData(JSON.stringify({action: act, amount: document.getElementById('mA').value, wallet: document.getElementById('mW').value}));
        tg.close();
    }
    update();
</script>
</body>
</html>
